好，我來幫你建立一個簡潔的 Spring Boot 專案，專門處理 Excel 匯出。

## 快速設定步驟

### 1. 建立專案結構

```bash
spring-boot-excel-export/
├── src/main/java/com/example/excel/
│   ├── ExcelApplication.java
│   ├── controller/
│   │   └── ExcelController.java
│   ├── model/
│   │   ├── ExcelRequest.java
│   │   └── ExcelSetting.java
│   └── service/
│       └── ExcelService.java
└── pom.xml
```

### 2. pom.xml 依賴

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 
         http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>3.2.0</version>
    </parent>
    
    <groupId>com.example</groupId>
    <artifactId>excel-export</artifactId>
    <version>1.0.0</version>
    
    <properties>
        <java.version>17</java.version>
    </properties>
    
    <dependencies>
        <!-- Spring Boot Web -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        
        <!-- Apache POI for Excel -->
        <dependency>
            <groupId>org.apache.poi</groupId>
            <artifactId>poi-ooxml</artifactId>
            <version>5.2.5</version>
        </dependency>
        
        <!-- Lombok (optional, 讓程式碼更簡潔) -->
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <optional>true</optional>
        </dependency>
    </dependencies>
    
    <build>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
            </plugin>
        </plugins>
    </build>
</project>
```

### 3. 主程式

```java
package com.example.excel;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class ExcelApplication {
    public static void main(String[] args) {
        SpringApplication.run(ExcelApplication.class, args);
    }
}
```

### 4. Model 類別

**ExcelRequest.java** - 接收前端傳來的請求
```java
package com.example.excel.model;

import lombok.Data;
import java.util.List;
import java.util.Map;

@Data
public class ExcelRequest {
    private ExcelSetting setting;
    private List<Map<String, Object>> data;
}
```

**ExcelSetting.java** - Excel 格式設定
```java
package com.example.excel.model;

import lombok.Data;
import java.util.List;

@Data
public class ExcelSetting {
    private String sheetName;
    private List<String> headers;
    private List<String> columnKeys;  // 對應 data 中的 key
    private Integer headerRowHeight;
    private Integer dataRowHeight;
    private Boolean autoSizeColumns;
}
```

### 5. Controller

```java
package com.example.excel.controller;

import com.example.excel.model.ExcelRequest;
import com.example.excel.service.ExcelService;
import lombok.RequiredArgsConstructor;
import org.springframework.http.HttpHeaders;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.io.ByteArrayOutputStream;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;

@RestController
@RequestMapping("/api/excel")
@RequiredArgsConstructor
public class ExcelController {
    
    private final ExcelService excelService;
    
    @PostMapping("/export")
    public ResponseEntity<byte[]> exportExcel(@RequestBody ExcelRequest request) {
        try {
            ByteArrayOutputStream outputStream = excelService.generateExcel(request);
            
            String filename = generateFilename(request.getSetting().getSheetName());
            
            return ResponseEntity.ok()
                    .header(HttpHeaders.CONTENT_DISPOSITION, 
                            "attachment; filename=\"" + filename + "\"")
                    .contentType(MediaType.parseMediaType(
                            "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"))
                    .body(outputStream.toByteArray());
                    
        } catch (Exception e) {
            return ResponseEntity.internalServerError().build();
        }
    }
    
    private String generateFilename(String sheetName) {
        String timestamp = LocalDateTime.now()
                .format(DateTimeFormatter.ofPattern("yyyyMMdd_HHmmss"));
        return (sheetName != null ? sheetName : "export") + "_" + timestamp + ".xlsx";
    }
}
```

### 6. Service - 核心邏輯

```java
package com.example.excel.service;

import com.example.excel.model.ExcelRequest;
import com.example.excel.model.ExcelSetting;
import org.apache.poi.ss.usermodel.*;
import org.apache.poi.xssf.usermodel.XSSFWorkbook;
import org.springframework.stereotype.Service;

import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.util.List;
import java.util.Map;

@Service
public class ExcelService {
    
    public ByteArrayOutputStream generateExcel(ExcelRequest request) throws IOException {
        Workbook workbook = new XSSFWorkbook();
        ExcelSetting setting = request.getSetting();
        
        // 建立 sheet
        Sheet sheet = workbook.createSheet(
                setting.getSheetName() != null ? setting.getSheetName() : "Sheet1"
        );
        
        // 建立樣式
        CellStyle headerStyle = createHeaderStyle(workbook);
        CellStyle dataStyle = createDataStyle(workbook);
        
        // 寫入表頭
        Row headerRow = sheet.createRow(0);
        if (setting.getHeaderRowHeight() != null) {
            headerRow.setHeightInPoints(setting.getHeaderRowHeight());
        }
        
        List<String> headers = setting.getHeaders();
        for (int i = 0; i < headers.size(); i++) {
            Cell cell = headerRow.createCell(i);
            cell.setCellValue(headers.get(i));
            cell.setCellStyle(headerStyle);
        }
        
        // 寫入資料
        List<Map<String, Object>> dataList = request.getData();
        List<String> columnKeys = setting.getColumnKeys();
        
        for (int rowIndex = 0; rowIndex < dataList.size(); rowIndex++) {
            Row row = sheet.createRow(rowIndex + 1);
            if (setting.getDataRowHeight() != null) {
                row.setHeightInPoints(setting.getDataRowHeight());
            }
            
            Map<String, Object> rowData = dataList.get(rowIndex);
            
            for (int colIndex = 0; colIndex < columnKeys.size(); colIndex++) {
                Cell cell = row.createCell(colIndex);
                Object value = rowData.get(columnKeys.get(colIndex));
                setCellValue(cell, value);
                cell.setCellStyle(dataStyle);
            }
        }
        
        // 自動調整欄寬
        if (Boolean.TRUE.equals(setting.getAutoSizeColumns())) {
            for (int i = 0; i < headers.size(); i++) {
                sheet.autoSizeColumn(i);
                // 加一點 padding
                sheet.setColumnWidth(i, sheet.getColumnWidth(i) + 512);
            }
        }
        
        // 輸出到 ByteArray
        ByteArrayOutputStream outputStream = new ByteArrayOutputStream();
        workbook.write(outputStream);
        workbook.close();
        
        return outputStream;
    }
    
    private CellStyle createHeaderStyle(Workbook workbook) {
        CellStyle style = workbook.createCellStyle();
        Font font = workbook.createFont();
        font.setBold(true);
        font.setFontHeightInPoints((short) 12);
        style.setFont(font);
        style.setFillForegroundColor(IndexedColors.GREY_25_PERCENT.getIndex());
        style.setFillPattern(FillPatternType.SOLID_FOREGROUND);
        style.setAlignment(HorizontalAlignment.CENTER);
        style.setVerticalAlignment(VerticalAlignment.CENTER);
        style.setBorderBottom(BorderStyle.THIN);
        style.setBorderTop(BorderStyle.THIN);
        style.setBorderLeft(BorderStyle.THIN);
        style.setBorderRight(BorderStyle.THIN);
        return style;
    }
    
    private CellStyle createDataStyle(Workbook workbook) {
        CellStyle style = workbook.createCellStyle();
        style.setAlignment(HorizontalAlignment.LEFT);
        style.setVerticalAlignment(VerticalAlignment.CENTER);
        style.setBorderBottom(BorderStyle.THIN);
        style.setBorderTop(BorderStyle.THIN);
        style.setBorderLeft(BorderStyle.THIN);
        style.setBorderRight(BorderStyle.THIN);
        return style;
    }
    
    private void setCellValue(Cell cell, Object value) {
        if (value == null) {
            cell.setCellValue("");
        } else if (value instanceof Number) {
            cell.setCellValue(((Number) value).doubleValue());
        } else if (value instanceof Boolean) {
            cell.setCellValue((Boolean) value);
        } else {
            cell.setCellValue(value.toString());
        }
    }
}
```

### 7. 測試用的 API 請求範例

```json
POST http://localhost:8080/api/excel/export
Content-Type: application/json

{
  "setting": {
    "sheetName": "員工資料",
    "headers": ["姓名", "部門", "薪資", "入職日期"],
    "columnKeys": ["name", "department", "salary", "hireDate"],
    "headerRowHeight": 25,
    "dataRowHeight": 20,
    "autoSizeColumns": true
  },
  "data": [
    {
      "name": "張三",
      "department": "技術部",
      "salary": 50000,
      "hireDate": "2023-01-15"
    },
    {
      "name": "李四",
      "department": "業務部",
      "salary": 45000,
      "hireDate": "2023-03-20"
    }
  ]
}
```

### 8. 啟動專案

```bash
mvn spring-boot:run
```

---

## 核心優勢

- **解耦設計**:設定和資料分離,前端可以自由控制格式
- **型別安全**:POI 自動處理數字、布林、字串
- **樣式統一**:表頭和資料區有不同的預設樣式
- **檔名自動生成**:含時間戳,避免重複

需要加什麼功能嗎?比如多 sheet、合併儲存格、條件格式化?