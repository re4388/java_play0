ä¸‹é¢çµ¦ä½ ä¸€å€‹**çœŸæ­£å¯è½åœ°çš„ Spring Boot å¯¦å‹™ç¯„ä¾‹**ï¼Œçµæ§‹æ˜¯æˆ‘åœ¨æ­£å¼å°ˆæ¡ˆæœƒç”¨çš„é‚£ç¨®ï¼š

ğŸ‘‰ **Controller åªè² è²¬ HTTP**
ğŸ‘‰ **Service ä¸çŸ¥é“ Excel å­˜åœ¨**
ğŸ‘‰ **POI è¢«åŒ…åœ¨ã€Œé€šç”¨åŒ¯å‡ºå·¥å…· + ExcelServiceã€**
ğŸ‘‰ **æœªä¾†æ› CSV / PDF éƒ½ä¸ç”¨å‹•å•†æ¥­é‚è¼¯**

---

# ä¸€ã€å°ˆæ¡ˆçµæ§‹ï¼ˆé‡é»ï¼‰

```text
com.example.demo
â”œâ”€ controller
â”‚  â””â”€ UserExportController.java
â”œâ”€ service
â”‚  â”œâ”€ UserService.java          // å•†æ¥­é‚è¼¯
â”‚  â””â”€ ExcelExportService.java   // å°ˆé–€è™•ç† Excel
â”œâ”€ excel
â”‚  â”œâ”€ ExcelExporter.java        // é€šç”¨ Excel åŒ¯å‡ºå·¥å…·
â”‚  â””â”€ ExcelColumn.java          // æ¬„ä½å®šç¾©
â”œâ”€ model
â”‚  â””â”€ User.java
```

---

# äºŒã€Maven ä¾è³´ï¼ˆåªéœ€è¦é€™å€‹ï¼‰

```xml
<dependency>
  <groupId>org.apache.poi</groupId>
  <artifactId>poi-ooxml</artifactId>
  <version>5.2.5</version>
</dependency>
```

---

# ä¸‰ã€è³‡æ–™æ¨¡å‹ï¼ˆå®Œå…¨ä¸çŸ¥é“ POIï¼‰

```java
public class User {
    private Long id;
    private String name;
    private String email;

    // getter / setter
}
```

---

# å››ã€é€šç”¨æ¬„ä½å®šç¾©ï¼ˆé—œéµè¨­è¨ˆï¼‰

```java
public class ExcelColumn<T> {

    private final String header;
    private final Function<T, Object> valueExtractor;

    public ExcelColumn(String header, Function<T, Object> valueExtractor) {
        this.header = header;
        this.valueExtractor = valueExtractor;
    }

    public String getHeader() {
        return header;
    }

    public Object getValue(T data) {
        return valueExtractor.apply(data);
    }
}
```

ğŸ“Œ **é€™å€‹è¨­è¨ˆè®“ä½ å®Œå…¨ä¸éœ€è¦åœ¨ POI è£¡å¯« getter**

---

# äº”ã€é€šç”¨ Excel åŒ¯å‡ºå·¥å…·ï¼ˆPOI å…¨é—œåœ¨é€™ï¼‰

```java
public class ExcelExporter<T> {

    public Workbook export(String sheetName,
                           List<ExcelColumn<T>> columns,
                           List<T> dataList) {

        Workbook wb = new SXSSFWorkbook(100);
        Sheet sheet = wb.createSheet(sheetName);

        // Header
        Row headerRow = sheet.createRow(0);
        for (int i = 0; i < columns.size(); i++) {
            headerRow.createCell(i).setCellValue(columns.get(i).getHeader());
        }

        // Data
        for (int i = 0; i < dataList.size(); i++) {
            Row row = sheet.createRow(i + 1);
            T data = dataList.get(i);

            for (int j = 0; j < columns.size(); j++) {
                Object value = columns.get(j).getValue(data);
                Cell cell = row.createCell(j);

                if (value instanceof Number) {
                    cell.setCellValue(((Number) value).doubleValue());
                } else {
                    cell.setCellValue(value == null ? "" : value.toString());
                }
            }
        }

        return wb;
    }
}
```

ğŸ“Œ

* `SXSSFWorkbook` â†’ **å¤§é‡è³‡æ–™ä¸çˆ†è¨˜æ†¶é«”**
* **æ²’æœ‰ä»»ä½•æ¥­å‹™æ¬„ä½å¯«æ­»**

---

# å…­ã€ExcelExportServiceï¼ˆPOI Serviceï¼‰

```java
@Service
public class ExcelExportService {

    public <T> void exportToResponse(
            String fileName,
            String sheetName,
            List<ExcelColumn<T>> columns,
            List<T> data,
            HttpServletResponse response) throws IOException {

        ExcelExporter<T> exporter = new ExcelExporter<>();
        Workbook wb = exporter.export(sheetName, columns, data);

        response.setContentType(
            "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet");
        response.setHeader(
            "Content-Disposition",
            "attachment; filename=\"" + fileName + "\"");

        try (wb; OutputStream os = response.getOutputStream()) {
            wb.write(os);
        }
    }
}
```

ğŸ“Œ **Controller ä¸æœƒçœ‹åˆ° POI**

---

# ä¸ƒã€å•†æ¥­ Serviceï¼ˆä¹¾æ·¨åˆ°ä¸è¡Œï¼‰

```java
@Service
public class UserService {

    public List<User> findAllUsers() {
        return List.of(
            new User(1L, "Tom", "tom@test.com"),
            new User(2L, "Mary", "mary@test.com")
        );
    }
}
```

---

# å…«ã€Controllerï¼ˆçœŸæ­£åªåš HTTPï¼‰

```java
@RestController
@RequestMapping("/users")
public class UserExportController {

    private final UserService userService;
    private final ExcelExportService excelExportService;

    public UserExportController(UserService userService,
                                ExcelExportService excelExportService) {
        this.userService = userService;
        this.excelExportService = excelExportService;
    }

    @GetMapping("/export")
    public void exportUsers(HttpServletResponse response) throws IOException {

        List<User> users = userService.findAllUsers();

        List<ExcelColumn<User>> columns = List.of(
            new ExcelColumn<>("ID", User::getId),
            new ExcelColumn<>("å§“å", User::getName),
            new ExcelColumn<>("Email", User::getEmail)
        );

        excelExportService.exportToResponse(
            "users.xlsx",
            "ä½¿ç”¨è€…æ¸…å–®",
            columns,
            users,
            response
        );
    }
}
```

---

# ä¹ã€é€™å€‹è¨­è¨ˆã€Œå²å®³ã€åœ¨å“ªï¼Ÿ

### âœ… å•†æ¥­é‚è¼¯å®Œå…¨ä¸çŸ¥é“ Excel

### âœ… æ¬„ä½é †åº / åç¨± Controller æ±ºå®š

### âœ… POI å¯è¢«æ›¿æ›ï¼ˆCSV / PDFï¼‰

### âœ… å¤§é‡è³‡æ–™ä¸æœƒç‚¸

### âœ… çœŸå¯¦å°ˆæ¡ˆå¯ç›´æ¥ç”¨

---

# åã€è€æ‰‹æœƒå†åŠ çš„æ±è¥¿ï¼ˆä½ ä¸‹ä¸€æ­¥ï¼‰

* æ—¥æœŸ / é‡‘é¡æ ¼å¼ç­–ç•¥
* æ¬„ä½å¯¬åº¦ç­–ç•¥ï¼ˆé¿å… `autoSizeColumn`)
* å…±ç”¨ BaseExportController
* éåŒæ­¥ç”¢æª” + S3 / MinIO

---

å¦‚æœä½ è¦ï¼Œæˆ‘å¯ä»¥ä¸‹ä¸€æ­¥ç›´æ¥å¹«ä½ ï¼š

* æŠ½æˆ **ä¼æ¥­ç´š ExcelExportTemplate**
* åŠ  **Annotation æ¨™è¨»æ¬„ä½**
* åšæˆ **å¤š Sheet / å‹•æ…‹æ¬„ä½**
* æ”¹æˆ **WebFlux / éåŒæ­¥**

ä½ åªè¦èªªã€Œæˆ‘è¦å“ªä¸€ç¨®ã€ï¼Œæˆ‘ç›´æ¥å¹«ä½ è£œé½Šã€‚
