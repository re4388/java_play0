å¤ªå¥½äº†ï¼Œé€™ä¸€æ­¥å°±æ˜¯æŠŠä½ é€™å¥— Excel Framework **æ­£å¼å‡ç´šæˆã€Œå‰å¾Œç«¯å¯å”ä½œçš„ä¼æ¥­ç´šåŒ¯å‡ºå¼•æ“ã€**ã€‚
æˆ‘æœƒç…§ã€Œ**å¯¦æˆ°å°ˆæ¡ˆçœŸçš„æœƒé€™æ¨£åš**ã€çš„æ–¹å¼ä¾†ã€‚

---

# ç›®æ¨™ï¼ˆä½ ç¾åœ¨è¦å¾—åˆ°çš„èƒ½åŠ›ï¼‰

âœ… **å‰ç«¯ç”¨ JSON æ±ºå®šï¼š**

* å“ªäº› Sheet è¦å‡º
* æ¯å€‹ Sheet è¦å“ªäº›æ¬„ä½
* æ¬„ä½é †åº
* Sheet åç¨±

âœ… **å¾Œç«¯ï¼š**

* å®Œå…¨ä¸å¯«æ­»æ¬„ä½
* ä¸æš´éœ² POI
* ä»ç„¶ä½¿ç”¨ä½ ä¹‹å‰çš„ `ExcelExportTemplate`

---

# ä¸€ã€å‰ç«¯é€ä¾†çš„ JSONï¼ˆæ ¸å¿ƒè¨­è¨ˆï¼‰

## ç¯„ä¾‹ï¼šå‰ç«¯åŒ¯å‡ºè¨­å®š

```json
{
  "fileName": "report.xlsx",
  "sheets": [
    {
      "sheetName": "Users",
      "type": "USER",
      "columns": ["id", "name", "email"]
    },
    {
      "sheetName": "Summary",
      "type": "USER_SUMMARY",
      "columns": ["totalUsers", "activeUsers", "generatedAt"]
    }
  ]
}
```

### ğŸ“Œ è¨­è¨ˆé‡é»

* `type`ï¼š**å¾Œç«¯è­˜åˆ¥è³‡æ–™ä¾†æºï¼ˆå®‰å…¨ï¼‰**
* `columns`ï¼šå‰ç«¯æ§åˆ¶æ¬„ä½ï¼ˆå‹•æ…‹ï¼‰
* **å‰ç«¯æ°¸é ä¸çŸ¥é“ Java class**

---

# äºŒã€å¾Œç«¯ DTOï¼ˆæ¥ JSONï¼‰

```java
public class ExcelExportRequest {

    private String fileName;
    private List<SheetConfig> sheets;

    // getter / setter
}
```

```java
public class SheetConfig {

    private String sheetName;
    private String type;            // USER / USER_SUMMARY
    private List<String> columns;   // æ¬„ä½ key

    // getter / setter
}
```

---

# ä¸‰ã€å¾Œç«¯è³‡æ–™é¡å‹ Enumï¼ˆé—œéµå®‰å…¨è¨­è¨ˆï¼‰

```java
public enum ExportSheetType {

    USER(User.class),
    USER_SUMMARY(UserSummary.class);

    private final Class<?> modelClass;

    ExportSheetType(Class<?> modelClass) {
        this.modelClass = modelClass;
    }

    public Class<?> getModelClass() {
        return modelClass;
    }
}
```

ğŸ“Œ **å‰ç«¯æ°¸é åªèƒ½é¸ä½ å…è¨±çš„é¡å‹**

---

# å››ã€è³‡æ–™æä¾›è€…ï¼ˆçœŸæ­£çš„å•†æ¥­é‚è¼¯ï¼‰

## æŠ½è±¡ä»‹é¢ï¼ˆä¼æ¥­ç´šé—œéµï¼‰

```java
public interface ExportDataProvider<T> {

    ExportSheetType getType();

    List<T> getData();
}
```

---

## å¯¦ä½œï¼šUser è³‡æ–™

```java
@Component
public class UserExportProvider
        implements ExportDataProvider<User> {

    private final UserService userService;

    public UserExportProvider(UserService userService) {
        this.userService = userService;
    }

    @Override
    public ExportSheetType getType() {
        return ExportSheetType.USER;
    }

    @Override
    public List<User> getData() {
        return userService.findAllUsers();
    }
}
```

---

## å¯¦ä½œï¼šSummary è³‡æ–™

```java
@Component
public class UserSummaryExportProvider
        implements ExportDataProvider<UserSummary> {

    private final UserService userService;

    @Override
    public ExportSheetType getType() {
        return ExportSheetType.USER_SUMMARY;
    }

    @Override
    public List<UserSummary> getData() {
        int total = userService.countAll();
        int active = userService.countActive();

        return List.of(
            new UserSummary(total, active, LocalDateTime.now())
        );
    }
}
```

ğŸ“Œ **æ¯å€‹ Sheet çš„è³‡æ–™ä¾†æºå®Œå…¨ç¨ç«‹**

---

# äº”ã€Provider Registryï¼ˆè‡ªå‹•é…å°ï¼‰

```java
@Component
public class ExportProviderRegistry {

    private final Map<ExportSheetType, ExportDataProvider<?>> providerMap;

    public ExportProviderRegistry(List<ExportDataProvider<?>> providers) {
        this.providerMap = providers.stream()
            .collect(Collectors.toMap(
                ExportDataProvider::getType,
                p -> p
            ));
    }

    @SuppressWarnings("unchecked")
    public <T> ExportDataProvider<T> getProvider(ExportSheetType type) {
        return (ExportDataProvider<T>) providerMap.get(type);
    }
}
```

ğŸ“Œ **é€™è£¡å°±æ˜¯ã€ŒJSON â†’ å•†æ¥­è³‡æ–™ã€çš„æ©‹æ¨‘**

---

# å…­ã€ExcelExportServiceï¼ˆå‡ç´šç‰ˆï¼‰

```java
@Service
public class ExcelExportService {

    private final ExportProviderRegistry registry;

    public ExcelExportService(ExportProviderRegistry registry) {
        this.registry = registry;
    }

    public void exportFromJson(
            ExcelExportRequest request,
            HttpServletResponse response) throws IOException {

        List<ExcelSheetMeta<?>> sheets = new ArrayList<>();

        for (SheetConfig cfg : request.getSheets()) {

            ExportSheetType type =
                ExportSheetType.valueOf(cfg.getType());

            ExportDataProvider<?> provider =
                registry.getProvider(type);

            ExcelSheetMeta<?> sheetMeta =
                new ExcelSheetMeta<>(
                    cfg.getSheetName(),
                    provider.getData(),
                    type.getModelClass(),
                    new LinkedHashSet<>(cfg.getColumns())
                );

            sheets.add(sheetMeta);
        }

        Workbook wb =
            new ExcelExportTemplate().export(sheets);

        response.setContentType(
            "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet");
        response.setHeader(
            "Content-Disposition",
            "attachment; filename=\"" + request.getFileName() + "\"");

        try (wb; OutputStream os = response.getOutputStream()) {
            wb.write(os);
        }
    }
}
```

---

# ä¸ƒã€Controllerï¼ˆå‰ç«¯å®Œå…¨ä¸»æ§ï¼‰

```java
@PostMapping("/export")
public void export(@RequestBody ExcelExportRequest request,
                   HttpServletResponse response) throws IOException {

    excelExportService.exportFromJson(request, response);
}
```

---

# å…«ã€ç¾åœ¨ä½ ã€ŒçœŸæ­£å¾—åˆ°ã€ä»€éº¼èƒ½åŠ›ï¼Ÿ

| èƒ½åŠ›                 | ç‹€æ…‹ |
| ------------------ | -- |
| å‰ç«¯æ§åˆ¶æ¬„ä½             | âœ…  |
| å¤š Sheet            | âœ…  |
| ä¸æš´éœ² Java Class     | âœ…  |
| POI å®Œå…¨éš”é›¢           | âœ…  |
| æ–°å¢å ±è¡¨ä¸ç”¨æ”¹ Controller | âœ…  |

---

# ä¹ã€ç‚ºä»€éº¼é€™æ˜¯ã€Œä¼æ¥­ç´šè§£æ³•ã€ï¼Ÿ

### âœ”ï¸ å‰ç«¯ = è¨­å®š

### âœ”ï¸ å¾Œç«¯ = è¦å‰‡ + å®‰å…¨

### âœ”ï¸ Excel = è¼¸å‡ºçµæœ

ğŸ‘‰ **æ²’æœ‰äººåœ¨ Controller å¯« Excel**
ğŸ‘‰ **æ²’æœ‰äººåœ¨ Service if/else åˆ¤æ–·æ¬„ä½**

---

# åã€ä¸‹ä¸€å€‹ã€Œå†å‡ç´šã€æ–¹å‘ï¼ˆä½ å·²ç¶“åˆ°é€™ä¸€å±¤äº†ï¼‰

ä½ ç¾åœ¨å·²ç¶“ç«™åœ¨ **Excel Framework 80% å®Œæˆåº¦**ï¼Œæ¥ä¸‹ä¾†å¯ä»¥å†ä¸Šï¼š

1ï¸âƒ£ æ¬„ä½ç™½åå–® / æ¬Šé™æ§ç®¡
2ï¸âƒ£ Sheet Template ä¸åŒæ¨£å¼
3ï¸âƒ£ åŒ¯å‡ºè¨­å®šå­˜ DBï¼ˆå ±è¡¨æ¨¡æ¿ï¼‰
4ï¸âƒ£ éåŒæ­¥åŒ¯å‡ºï¼ˆQueue + S3ï¼‰

ä½ åªè¦å›ä¸€å¥ï¼š
ğŸ‘‰ **ã€Œæˆ‘è¦å‡ç´šåˆ° Xã€**
æˆ‘ç›´æ¥å¹«ä½ è£œåˆ°å¯ä»¥åœ¨å…¬å¸ç”¨ã€äº¤æ¥ä¹Ÿä¸æ€•çš„ç­‰ç´šã€‚
